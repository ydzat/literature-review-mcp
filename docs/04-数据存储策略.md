# æ•°æ®å­˜å‚¨ç­–ç•¥åˆ†æ
## æœ¬åœ°å­˜å‚¨ vs Notion å­˜å‚¨çš„æƒè¡¡

---

## ğŸ“Š å½“å‰å­˜å‚¨æ–¹æ¡ˆåˆ†æ

### ç°æœ‰è®¾è®¡
```
WORK_DIR/
â”œâ”€â”€ [arxiv_id].pdf              # PDF åŸæ–‡
â”œâ”€â”€ [arxiv_id]_text.txt         # æå–çš„æ–‡æœ¬
â”œâ”€â”€ [arxiv_id]_review.md        # ç”Ÿæˆçš„ç»¼è¿°
â””â”€â”€ ...
```

**ä¼˜ç‚¹**:
- âœ… ç®€å•ç›´æ¥
- âœ… ç”¨æˆ·å®Œå…¨æ§åˆ¶
- âœ… ç¦»çº¿å¯ç”¨

**ç¼ºç‚¹**:
- âŒ æ–‡ä»¶æ•£ä¹±ï¼Œéš¾ä»¥ç®¡ç†
- âŒ æ— æ³•è·¨è®¾å¤‡è®¿é—®
- âŒ ç¼ºä¹ç»“æ„åŒ–ç»„ç»‡
- âŒ ä¸ Notion è¾“å‡ºé‡å¤

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

### 1. å“ªäº›æ•°æ®å¿…é¡»æœ¬åœ°å­˜å‚¨ï¼Ÿ

#### âœ… **å¿…é¡»æœ¬åœ°å­˜å‚¨**
1. **PDF åŸæ–‡**
   - åŸå› : éœ€è¦è§£ææå–æ–‡æœ¬ï¼ŒNotion ä¸é€‚åˆå­˜å‚¨å¤§å‹ PDF
   - ç”¨é€”: æ–‡æœ¬æå–ã€å…³é”®ä¿¡æ¯æå–ã€æ¥æºéªŒè¯
   - å¤§å°: é€šå¸¸ 1-10 MB/ç¯‡

2. **æå–çš„æ–‡æœ¬å†…å®¹**
   - åŸå› : ä½œä¸º AI åˆ†æçš„è¾“å…¥ï¼Œéœ€è¦å¿«é€Ÿè®¿é—®
   - ç”¨é€”: ç»¼è¿°ç”Ÿæˆã€å…³é”®ä¿¡æ¯æå–ã€å…³ç³»åˆ†æ
   - å¤§å°: é€šå¸¸ 100-500 KB/ç¯‡

3. **ç¼“å­˜æ•°æ®**
   - åŸå› : é¿å…é‡å¤è°ƒç”¨å¤–éƒ¨ APIï¼ˆarXiv, DBLP, etc.ï¼‰
   - ç”¨é€”: æé«˜æ€§èƒ½ï¼Œå‡å°‘ API è°ƒç”¨
   - å¤§å°: é€šå¸¸ 10-100 KB/ç¯‡

#### âŒ **ä¸å¿…æœ¬åœ°å­˜å‚¨**
1. **ç”Ÿæˆçš„ç»¼è¿°** â†’ ç›´æ¥è¾“å‡ºåˆ° Notion
2. **è®ºæ–‡å…ƒæ•°æ®** â†’ ç›´æ¥è¾“å‡ºåˆ° Notion æ•°æ®åº“
3. **ä½œè€…/æœºæ„ä¿¡æ¯** â†’ ç›´æ¥è¾“å‡ºåˆ° Notion æ•°æ®åº“

### 2. æœ¬åœ°å­˜å‚¨çš„å¿…è¦æ€§

**åœºæ™¯ 1: æ–‡çŒ®ç»¼è¿°ç”Ÿæˆ**
```
ç”¨æˆ·è¯·æ±‚ â†’ ä¸‹è½½ PDF â†’ æå–æ–‡æœ¬ â†’ AI åˆ†æ â†’ ç”Ÿæˆç»¼è¿° â†’ è¾“å‡ºåˆ° Notion
           â†“           â†“
         æœ¬åœ°å­˜å‚¨    æœ¬åœ°å­˜å‚¨
```
- **PDF å’Œæ–‡æœ¬å¿…é¡»æœ¬åœ°å­˜å‚¨**: ä½œä¸ºåˆ†æçš„åŸå§‹ææ–™
- **ç»¼è¿°ä¸å¿…æœ¬åœ°å­˜å‚¨**: ç›´æ¥è¾“å‡ºåˆ° Notion

**åœºæ™¯ 2: è®ºæ–‡æœç´¢**
```
ç”¨æˆ·è¯·æ±‚ â†’ è°ƒç”¨ API â†’ è·å–å…ƒæ•°æ® â†’ è¾“å‡ºåˆ° Notion
                      â†“
                   å¯é€‰ç¼“å­˜
```
- **å…ƒæ•°æ®å¯é€‰ç¼“å­˜**: æé«˜æ€§èƒ½ï¼Œä½†ä¸æ˜¯å¿…é¡»

**åœºæ™¯ 3: ç¦»çº¿ä½¿ç”¨**
```
ç”¨æˆ·è¯·æ±‚ â†’ è¯»å–æœ¬åœ°ç¼“å­˜ â†’ è¾“å‡ºç»“æœ
```
- **ç¼“å­˜æœ‰ä»·å€¼**: æ”¯æŒç¦»çº¿ä½¿ç”¨

---

## ğŸ’¡ æ¨èçš„å­˜å‚¨ç­–ç•¥

### æ–¹æ¡ˆ A: æ··åˆå­˜å‚¨ï¼ˆæ¨èï¼‰â­â­â­â­â­

**è®¾è®¡åŸåˆ™**: 
- **æœ¬åœ°å­˜å‚¨**: åŸå§‹æ•°æ®ï¼ˆPDFã€æ–‡æœ¬ï¼‰+ ç¼“å­˜
- **Notion å­˜å‚¨**: ç»“æ„åŒ–çŸ¥è¯†ï¼ˆç»¼è¿°ã€å…ƒæ•°æ®ã€å…³ç³»ï¼‰

**ç›®å½•ç»“æ„**:
```
~/.arxiv-mcp/                    # ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„éšè—ç›®å½•
â”œâ”€â”€ cache/                       # ç¼“å­˜ç›®å½•
â”‚   â”œâ”€â”€ papers/                  # è®ºæ–‡å…ƒæ•°æ®ç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ 1706.03762.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ authors/                 # ä½œè€…ä¿¡æ¯ç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ yann_lecun.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ api_responses/           # API å“åº”ç¼“å­˜
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ pdfs/                        # PDF å­˜å‚¨
â”‚   â”œâ”€â”€ 1706.03762.pdf
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ texts/                       # æå–çš„æ–‡æœ¬
â”‚   â”œâ”€â”€ 1706.03762.txt
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ config.json                  # é…ç½®æ–‡ä»¶
```

**ä¼˜ç‚¹**:
- âœ… æ¸…æ™°çš„ç›®å½•ç»“æ„
- âœ… éšè—ç›®å½•ï¼Œä¸å¹²æ‰°ç”¨æˆ·å·¥ä½œåŒº
- âœ… ç¼“å­˜æé«˜æ€§èƒ½
- âœ… PDF å’Œæ–‡æœ¬å¯é‡å¤ä½¿ç”¨
- âœ… ä¸ Notion è¾“å‡ºä¸å†²çª

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦ç®¡ç†ç¼“å­˜è¿‡æœŸ
- âš ï¸ å ç”¨ç£ç›˜ç©ºé—´

### æ–¹æ¡ˆ B: çº¯ä¸´æ—¶å­˜å‚¨ â­â­â­

**è®¾è®¡åŸåˆ™**: 
- **ä¸´æ—¶å­˜å‚¨**: PDF å’Œæ–‡æœ¬ä»…åœ¨å¤„ç†æ—¶å­˜å‚¨ï¼Œå¤„ç†å®Œåˆ é™¤
- **Notion å­˜å‚¨**: æ‰€æœ‰ç»“æ„åŒ–çŸ¥è¯†

**ç›®å½•ç»“æ„**:
```
/tmp/arxiv-mcp-[session-id]/     # ä¸´æ—¶ç›®å½•
â”œâ”€â”€ 1706.03762.pdf
â”œâ”€â”€ 1706.03762.txt
â””â”€â”€ ...
```

**ä¼˜ç‚¹**:
- âœ… ä¸å ç”¨é•¿æœŸå­˜å‚¨ç©ºé—´
- âœ… è‡ªåŠ¨æ¸…ç†

**ç¼ºç‚¹**:
- âŒ æ¯æ¬¡éƒ½éœ€è¦é‡æ–°ä¸‹è½½ PDF
- âŒ æ— æ³•ç¦»çº¿ä½¿ç”¨
- âŒ æ€§èƒ½è¾ƒå·®

### æ–¹æ¡ˆ C: ç”¨æˆ·æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰â­â­

**è®¾è®¡åŸåˆ™**: 
- **ç”¨æˆ·æ§åˆ¶**: ç”¨æˆ·æŒ‡å®š WORK_DIR
- **æ‰€æœ‰æ•°æ®**: PDFã€æ–‡æœ¬ã€ç»¼è¿°éƒ½å­˜å‚¨åœ¨ WORK_DIR

**ä¼˜ç‚¹**:
- âœ… ç”¨æˆ·å®Œå…¨æ§åˆ¶
- âœ… çµæ´»æ€§é«˜

**ç¼ºç‚¹**:
- âŒ æ–‡ä»¶æ•£ä¹±
- âŒ ä¸ Notion è¾“å‡ºé‡å¤
- âŒ éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç®¡ç†

---

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### é‡‡ç”¨ **æ–¹æ¡ˆ A: æ··åˆå­˜å‚¨**

#### 1. ç›®å½•ç»“æ„
```typescript
const STORAGE_ROOT = path.join(os.homedir(), '.arxiv-mcp');

const STORAGE_PATHS = {
  root: STORAGE_ROOT,
  cache: path.join(STORAGE_ROOT, 'cache'),
  papers: path.join(STORAGE_ROOT, 'cache', 'papers'),
  authors: path.join(STORAGE_ROOT, 'cache', 'authors'),
  apiResponses: path.join(STORAGE_ROOT, 'cache', 'api_responses'),
  pdfs: path.join(STORAGE_ROOT, 'pdfs'),
  texts: path.join(STORAGE_ROOT, 'texts'),
  config: path.join(STORAGE_ROOT, 'config.json')
};
```

#### 2. ç¼“å­˜ç­–ç•¥
```typescript
interface CacheEntry<T> {
  data: T;
  timestamp: number;
  ttl: number;  // Time to live (ç§’)
}

class CacheManager {
  // è®ºæ–‡å…ƒæ•°æ®ç¼“å­˜ - 7 å¤©
  async cachePaperMetadata(arxivId: string, data: any): Promise<void> {
    const entry: CacheEntry<any> = {
      data,
      timestamp: Date.now(),
      ttl: 7 * 24 * 60 * 60  // 7 å¤©
    };
    await fs.promises.writeFile(
      path.join(STORAGE_PATHS.papers, `${arxivId}.json`),
      JSON.stringify(entry, null, 2)
    );
  }
  
  // ä½œè€…ä¿¡æ¯ç¼“å­˜ - 30 å¤©
  async cacheAuthorInfo(authorName: string, data: any): Promise<void> {
    const entry: CacheEntry<any> = {
      data,
      timestamp: Date.now(),
      ttl: 30 * 24 * 60 * 60  // 30 å¤©
    };
    await fs.promises.writeFile(
      path.join(STORAGE_PATHS.authors, `${authorName}.json`),
      JSON.stringify(entry, null, 2)
    );
  }
  
  // API å“åº”ç¼“å­˜ - 1 å¤©
  async cacheApiResponse(key: string, data: any): Promise<void> {
    const entry: CacheEntry<any> = {
      data,
      timestamp: Date.now(),
      ttl: 24 * 60 * 60  // 1 å¤©
    };
    await fs.promises.writeFile(
      path.join(STORAGE_PATHS.apiResponses, `${key}.json`),
      JSON.stringify(entry, null, 2)
    );
  }
  
  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
  async isCacheValid<T>(filePath: string): Promise<boolean> {
    try {
      const content = await fs.promises.readFile(filePath, 'utf-8');
      const entry: CacheEntry<T> = JSON.parse(content);
      const age = (Date.now() - entry.timestamp) / 1000;
      return age < entry.ttl;
    } catch {
      return false;
    }
  }
}
```

#### 3. PDF ç®¡ç†
```typescript
class PdfManager {
  // ä¸‹è½½å¹¶ç¼“å­˜ PDF
  async downloadPdf(arxivId: string): Promise<string> {
    const pdfPath = path.join(STORAGE_PATHS.pdfs, `${arxivId}.pdf`);
    
    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    if (fs.existsSync(pdfPath)) {
      console.log(`âœ… PDF å·²ç¼“å­˜: ${pdfPath}`);
      return pdfPath;
    }
    
    // ä¸‹è½½ PDF
    console.log(`â¬‡ï¸ ä¸‹è½½ PDF: ${arxivId}`);
    const pdfUrl = `https://arxiv.org/pdf/${arxivId}.pdf`;
    const response = await axios.get(pdfUrl, { responseType: 'arraybuffer' });
    await fs.promises.writeFile(pdfPath, response.data);
    
    return pdfPath;
  }
  
  // æå–å¹¶ç¼“å­˜æ–‡æœ¬
  async extractText(arxivId: string): Promise<string> {
    const textPath = path.join(STORAGE_PATHS.texts, `${arxivId}.txt`);
    
    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    if (fs.existsSync(textPath)) {
      console.log(`âœ… æ–‡æœ¬å·²ç¼“å­˜: ${textPath}`);
      return await fs.promises.readFile(textPath, 'utf-8');
    }
    
    // æå–æ–‡æœ¬
    const pdfPath = await this.downloadPdf(arxivId);
    const text = await parsePdfToText(pdfPath);
    await fs.promises.writeFile(textPath, text);
    
    return text;
  }
  
  // æ¸…ç†æ—§çš„ PDFï¼ˆå¯é€‰ï¼‰
  async cleanOldPdfs(daysOld: number = 90): Promise<void> {
    const files = await fs.promises.readdir(STORAGE_PATHS.pdfs);
    const now = Date.now();
    
    for (const file of files) {
      const filePath = path.join(STORAGE_PATHS.pdfs, file);
      const stats = await fs.promises.stat(filePath);
      const age = (now - stats.mtimeMs) / (1000 * 60 * 60 * 24);
      
      if (age > daysOld) {
        await fs.promises.unlink(filePath);
        console.log(`ğŸ—‘ï¸ åˆ é™¤æ—§ PDF: ${file}`);
      }
    }
  }
}
```

#### 4. é…ç½®ç®¡ç†
```typescript
interface Config {
  version: string;
  cacheEnabled: boolean;
  cacheTtl: {
    papers: number;
    authors: number;
    apiResponses: number;
  };
  pdfRetentionDays: number;
  notionIntegration: {
    enabled: boolean;
    autoSync: boolean;
  };
}

const DEFAULT_CONFIG: Config = {
  version: '1.0.0',
  cacheEnabled: true,
  cacheTtl: {
    papers: 7 * 24 * 60 * 60,      // 7 å¤©
    authors: 30 * 24 * 60 * 60,    // 30 å¤©
    apiResponses: 24 * 60 * 60     // 1 å¤©
  },
  pdfRetentionDays: 90,
  notionIntegration: {
    enabled: true,
    autoSync: false
  }
};
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### Phase 1: è¿ç§»åˆ°æ–°å­˜å‚¨ç»“æ„ï¼ˆ2-3 å¤©ï¼‰
- [ ] åˆ›å»º `src/storage/` ç›®å½•
- [ ] å®ç° `CacheManager` ç±»
- [ ] å®ç° `PdfManager` ç±»
- [ ] å®ç° `ConfigManager` ç±»
- [ ] è¿ç§»ç°æœ‰ä»£ç åˆ°æ–°ç»“æ„

### Phase 2: ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼ˆ1-2 å¤©ï¼‰
- [ ] å®ç°ç¼“å­˜è¿‡æœŸæ£€æŸ¥
- [ ] å®ç°ç¼“å­˜æ¸…ç†
- [ ] æ·»åŠ ç¼“å­˜ç»Ÿè®¡

### Phase 3: æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ1 å¤©ï¼‰
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ–‡æ¡£æ›´æ–°

**æ€»è®¡**: 4-6 å¤©ï¼ˆçº¦ 1 å‘¨ï¼‰

---

## ğŸ¯ æœ€ç»ˆå­˜å‚¨æ¶æ„

```
æœ¬åœ°å­˜å‚¨ (~/.arxiv-mcp/)
â”œâ”€â”€ PDF åŸæ–‡ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
â”œâ”€â”€ æå–çš„æ–‡æœ¬ï¼ˆé•¿æœŸç¼“å­˜ï¼‰
â””â”€â”€ API å“åº”ç¼“å­˜ï¼ˆçŸ­æœŸç¼“å­˜ï¼‰

Notion å­˜å‚¨
â”œâ”€â”€ ç»¼è¿°æ–‡æ¡£ï¼ˆç»“æ„åŒ–é¡µé¢ï¼‰
â”œâ”€â”€ è®ºæ–‡æ•°æ®åº“ï¼ˆå…ƒæ•°æ®ï¼‰
â”œâ”€â”€ ä½œè€…æ•°æ®åº“ï¼ˆå£°èª‰ä¿¡æ¯ï¼‰
â””â”€â”€ æœºæ„æ•°æ®åº“ï¼ˆç­‰çº§ä¿¡æ¯ï¼‰
```

**æ•°æ®æµ**:
```
ç”¨æˆ·è¯·æ±‚
  â†“
æ£€æŸ¥æœ¬åœ°ç¼“å­˜
  â†“ (æœªå‘½ä¸­)
ä¸‹è½½ PDF â†’ æœ¬åœ°å­˜å‚¨
  â†“
æå–æ–‡æœ¬ â†’ æœ¬åœ°å­˜å‚¨
  â†“
AI åˆ†æ
  â†“
ç”Ÿæˆç»“æ„åŒ–è¾“å‡º + notion_metadata
  â†“
Agent ä½¿ç”¨ notion_metadata â†’ Notion
```

---

## âœ… ä¼˜åŠ¿æ€»ç»“

### å¯¹ç”¨æˆ·
- âœ… **é€æ˜**: ç”¨æˆ·æ— éœ€å…³å¿ƒæœ¬åœ°å­˜å‚¨ï¼Œè‡ªåŠ¨ç®¡ç†
- âœ… **é«˜æ•ˆ**: ç¼“å­˜é¿å…é‡å¤ä¸‹è½½å’Œå¤„ç†
- âœ… **æ•´æ´**: æ‰€æœ‰æ•°æ®é›†ä¸­åœ¨ `~/.arxiv-mcp/`
- âœ… **çµæ´»**: å¯é…ç½®ç¼“å­˜ç­–ç•¥

### å¯¹ç³»ç»Ÿ
- âœ… **æ€§èƒ½**: ç¼“å­˜æé«˜å“åº”é€Ÿåº¦
- âœ… **å¯é **: ç¦»çº¿å¯ç”¨ï¼ˆå·²ç¼“å­˜çš„æ•°æ®ï¼‰
- âœ… **å¯ç»´æŠ¤**: æ¸…æ™°çš„ç›®å½•ç»“æ„
- âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„ç¼“å­˜ç±»å‹

---

**æ¨è**: é‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆæ··åˆå­˜å‚¨ï¼‰ï¼Œåœ¨ `~/.arxiv-mcp/` ä¸‹ç®¡ç†æœ¬åœ°æ•°æ®ï¼Œç»“æ„åŒ–çŸ¥è¯†è¾“å‡ºåˆ° Notion ğŸ“š

